---
description: 渐进式开发工作流程 - 小步迭代，频繁确认，用户掌控所有关键细节
alwaysApply: true
---

# 渐进式开发与用户掌控原则

## 核心原则

用户需要对代码库有**完全掌控**，这意味着：
- 每个函数的输入输出、主要逻辑、边界情况都需要用户确认
- 技术栈选择、关键假设、配置、整体设计、模块设计等都需要用户确认
- **避免认知过载**：每次输出要小而精，不要一次性生成大量代码

## 工作流程

### 1. 重大决策必须先确认

在开始实现之前，必须与用户确认：
- ✅ 技术栈选择（框架、库、工具）
- ✅ 整体架构设计
- ✅ 模块划分和职责
- ✅ 关键假设和约束
- ✅ 重要配置选项

### 2. 函数实现采用两阶段方式

**阶段一：设计阶段（先提交，等确认）**

```typescript
/**
 * 函数功能描述
 * 
 * @param param1 - 参数1的说明
 * @param param2 - 参数2的说明
 * @returns 返回值说明
 * 
 * 边界情况：
 * - case1: 如何处理
 * - case2: 如何处理
 */
function exampleFunction(param1: Type1, param2: Type2): ReturnType {
  // 步骤1：主要逻辑的自然语言描述
  // 步骤2：...
  // 步骤3：...
  
  // 边界处理：
  // - 对于 case1，执行...
  // - 对于 case2，执行...
}
```

**阶段二：实现阶段（用户确认后）**

在用户确认设计后，再逐个实现具体代码。

### 3. 小步迭代，频繁确认

❌ **不要做**：
- 一次性生成大量代码（多个函数、多个文件）
- 未经确认就进行完整实现
- 假设用户的意图，自行做出重要决策
- 用纯文字方式罗列问题让用户回答

✅ **应该做**：
- 每次只处理1-2个函数或一个小模块
- 先展示设计（签名+注释），等确认后再实现
- 使用 **AskQuestion 工具**进行结构化确认（单选/多选）
- 对于开放性问题才使用文字询问

### 4. 使用 AskQuestion 工具进行确认

**何时使用 AskQuestion**：
- ✅ 技术栈选择（多个可选方案）
- ✅ 配置参数选择（有明确选项）
- ✅ 设计方案确认（通过/需要调整）
- ✅ 实现细节的多种方案选择

**何时使用文字询问**：
- 开放性问题（如"你希望支持哪些功能？"）
- 需要用户自由描述的场景

### 5. 控制输出粒度

每次回复控制在合理范围内：
- **设计阶段**：1-3个函数签名 + 注释
- **实现阶段**：1-2个函数的完整实现
- **重构/修改**：每次聚焦一个明确的改进点

## 示例对话流程

**用户**：实现一个用户认证模块

**AI 应该这样做**：

```
好的，我们来设计用户认证模块。让我先确认几个关键的技术决策：

[使用 AskQuestion 工具]
- 问题1: 认证方式选择？
  选项: JWT token / Session-based / OAuth2
- 问题2: 密码哈希算法？
  选项: bcrypt / argon2 / scrypt
- 问题3: Token 过期时间？
  选项: 15分钟 / 1小时 / 24小时 / 自定义
```

**（用户通过工具选择后）**

```
收到。基于你的选择（JWT + bcrypt + 1小时过期），我先设计核心函数：

[展示 1-2 个函数的签名和注释，用代码块]

这样设计可以吗？
[使用 AskQuestion 工具确认]
- 设计是否 OK？
  选项: 确认，继续实现 / 需要调整
```

## 记住

- 🎯 用户掌控细节，AI 负责执行
- 🔄 频繁确认 > 一次性完成
- 📦 小步迭代 > 大批量输出
- 💬 有疑问就问 > 自行假设
